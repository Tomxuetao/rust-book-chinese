<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>生命周期确保引用有效 | Rust 程序设计语言</title>
    <meta name="description" content="12">
    <link rel="stylesheet" href="/rust-book-chinese/assets/style.3f52c1a3.css">
    <link rel="modulepreload" href="/rust-book-chinese/assets/app.c05c6abe.js">
    <link rel="modulepreload" href="/rust-book-chinese/assets/ch10-03-lifetime-syntax.md.d6b72f04.lean.js">
    
    <link rel="icon" href="./logo.svg">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5a32397e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-8797f3b1></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-8797f3b1> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5a32397e data-v-844b3681><div class="VPNavBar has-sidebar" data-v-844b3681 data-v-44e2ad78><div class="container" data-v-44e2ad78><div class="VPNavBarTitle has-sidebar" data-v-44e2ad78 data-v-5e1f4c59><a class="title" href="/rust-book-chinese/" data-v-5e1f4c59><!--[--><!--]--><!--[--><img class="VPImage logo" src="/rust-book-chinese/logo.svg" alt data-v-9faac1f9><!--]--><!--[-->Rust 程序设计语言<!--]--><!--[--><!--]--></a></div><div class="content" data-v-44e2ad78><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-44e2ad78 data-v-1134acb1><span id="main-nav-aria-label" class="visually-hidden" data-v-1134acb1>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-1134acb1 data-v-1f7f9eb5><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-1f7f9eb5><span class="text" data-v-1f7f9eb5><!----> 相关链接 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-1f7f9eb5><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-1f7f9eb5><div class="VPMenu" data-v-1f7f9eb5 data-v-5eff23a1><div class="items" data-v-5eff23a1><!--[--><!--[--><div class="VPMenuLink" data-v-5eff23a1 data-v-be44beed><a class="VPLink link" href="https://kaisery.github.io/trpl-zh-cn/" target="_blank" rel="noreferrer" data-v-be44beed data-v-b4bd4949><!--[-->原文地址<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-b4bd4949><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-44e2ad78 data-v-f8b28756 data-v-1f7f9eb5><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-1f7f9eb5><span class="text" data-v-1f7f9eb5><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="option-icon" data-v-1f7f9eb5><path d="M0 0h24v24H0z" fill="none"></path><path d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z " class="css-c4d79v"></path></svg>  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-1f7f9eb5><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-1f7f9eb5><div class="VPMenu" data-v-1f7f9eb5 data-v-5eff23a1><!----><!--[--><!--[--><div class="items" data-v-f8b28756><p class="title" data-v-f8b28756>简体中文</p><!--[--><div class="VPMenuLink" data-v-f8b28756 data-v-be44beed><a class="VPLink link" href="https://doc.rust-lang.org/book/" target="_blank" rel="noreferrer" data-v-be44beed data-v-b4bd4949><!--[-->English<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-b4bd4949><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><div class="VPMenuLink" data-v-f8b28756 data-v-be44beed><a class="VPLink link" href="https://kaisery.github.io/trpl-zh-cn/" target="_blank" rel="noreferrer" data-v-be44beed data-v-b4bd4949><!--[-->简体中文<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-b4bd4949><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-44e2ad78 data-v-5af3f2ee><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-5af3f2ee data-v-7fd28aaf data-v-aa84d257><span class="check" data-v-aa84d257><span class="icon" data-v-aa84d257><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-7fd28aaf><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-7fd28aaf><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-44e2ad78 data-v-384d5cd3 data-v-760a41c8><!--[--><a class="VPSocialLink" href="https://github.com/Tomxuetao/rust-book-chinese.git" target="_blank" rel="noopener" data-v-760a41c8 data-v-0a6f450d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-44e2ad78 data-v-6568726d data-v-1f7f9eb5><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-1f7f9eb5><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-1f7f9eb5><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-1f7f9eb5><div class="VPMenu" data-v-1f7f9eb5 data-v-5eff23a1><!----><!--[--><!--[--><div class="group" data-v-6568726d><p class="trans-title" data-v-6568726d>简体中文</p><!--[--><div class="VPMenuLink" data-v-6568726d data-v-be44beed><a class="VPLink link" href="https://doc.rust-lang.org/book/" target="_blank" rel="noreferrer" data-v-be44beed data-v-b4bd4949><!--[-->English<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-b4bd4949><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><div class="VPMenuLink" data-v-6568726d data-v-be44beed><a class="VPLink link" href="https://kaisery.github.io/trpl-zh-cn/" target="_blank" rel="noreferrer" data-v-be44beed data-v-b4bd4949><!--[-->简体中文<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-b4bd4949><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--></div><div class="group" data-v-6568726d><div class="item appearance" data-v-6568726d><p class="label" data-v-6568726d>Appearance</p><div class="appearance-action" data-v-6568726d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-6568726d data-v-7fd28aaf data-v-aa84d257><span class="check" data-v-aa84d257><span class="icon" data-v-aa84d257><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-7fd28aaf><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-7fd28aaf><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-6568726d><div class="item social-links" data-v-6568726d><div class="VPSocialLinks social-links-list" data-v-6568726d data-v-760a41c8><!--[--><a class="VPSocialLink" href="https://github.com/Tomxuetao/rust-book-chinese.git" target="_blank" rel="noopener" data-v-760a41c8 data-v-0a6f450d><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-44e2ad78 data-v-c0a1034f><span class="container" data-v-c0a1034f><span class="top" data-v-c0a1034f></span><span class="middle" data-v-c0a1034f></span><span class="bottom" data-v-c0a1034f></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-5a32397e data-v-97bfa1ab><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-97bfa1ab><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-97bfa1ab><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-97bfa1ab>Menu</span></button><a class="top-link" href="#" data-v-97bfa1ab> Return to top </a></div><aside class="VPSidebar" data-v-5a32397e data-v-9c83b8b4><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-9c83b8b4><span class="visually-hidden" id="sidebar-aria-label" data-v-9c83b8b4> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>1. 入门指南</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch01-01-installation.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>1.1. 安装</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch01-02-hello-world.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>1.2. Hello,World!</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch01-03-hello-cargo.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>1.3. Hello,Cargo!</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>3. 常见编程概念</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch03-01-variables-and-mutability.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>3.1. 变量与可变性</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch03-02-data-types.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>3.2. 数据类型</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch03-03-how-functions-work.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>3.3. 函数</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch03-04-comments.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>3.4. 注释</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch03-05-control-flow.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>3.5. 控制流</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>4. 认识所有权</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch04-01-what-is-ownership.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>4.1. 什么是所有权？</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch04-02-references-and-borrowing.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>4.2. 引用与借用</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch04-03-slices.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>4.3. Slice 类型</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>5. 使用结构体组织相关联的数据</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch05-01-defining-structs.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>5.1. 结构体的定义和实例化</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch05-02-example-structs.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>5.2. 结构体示例程序</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch05-03-method-syntax.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>5.3. 方法语法</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>6. 枚举和模式匹配</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch06-01-defining-an-enum.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>6.1. 枚举的定义</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch06-02-match.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>6.2. match 控制流结构</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch06-03-if-let.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>6.3. if let 简洁控制流</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>7. 使用包、Crate 和模块管理不断增长的项目</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch07-01-packages-and-crates.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>7.1. 包和 Crate</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch07-02-defining-modules-to-control-scope-and-privacy.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>7.2. 定义模块来控制作用域与私有性</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>7.3. 引用模块项目的路径</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch07-04-bringing-paths-into-scope-with-the-use-keyword.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>7.4. 使用 use 关键字将路径引入作用域</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch07-05-separating-modules-into-different-files.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>7.5. 将模块拆分成多个文件</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>8. 常见集合</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch08-01-vectors.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>8.1. 使用 Vector 储存列表</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch08-02-strings.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>8.2. 使用字符串储存 UTF-8 编码的文本</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch08-03-hash-maps.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>8.3. 使用 Hash Map 储存键值对</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>9. 错误处理</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch09-01-unrecoverable-errors-with-panic.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>9.1. 用 panic! 处理不可恢复的错误</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch09-02-recoverable-errors-with-result.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>9.2. 用 Result 处理可恢复的错误</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch09-03-to-panic-or-not-to-panic.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>9.3. 要不要 panic!</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>10. 泛型、Trait 和生命周期</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch10-01-syntax.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>10.1. 泛型数据类型</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch10-02-traits.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>10.2. Trait：定义共同行为</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/rust-book-chinese/ch10-03-lifetime-syntax.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>10.3. 生命周期确保引用有效</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>11. 编写自动化测试</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch11-01-writing-tests.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>11.1. 如何编写测试</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch11-02-running-tests.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>11.2. 控制测试如何运行</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch11-03-test-organization.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>11.3. 测试的组织结构</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>12. 一个 I/O 项目：构建命令行程序</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch12-01-accepting-command-line-arguments.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>12.1. 接受命令行参数</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch12-02-reading-a-file.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>12.2. 读取文件</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch12-03-improving-error-handling-and-modularity.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>12.3. 重构以改进模块化与错误处理</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch12-04-testing-the-librarys-functionality.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>12.4. 采用测试驱动开发完善库的功能</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch12-05-working-with-environment-variables.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>12.5. 处理环境变量</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch12-06-writing-to-stderr-instead-of-stdout.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>12.6. 将错误信息输出到标准错误而不是标准输出</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>13. Rust 中的函数式语言功能：迭代器与闭包</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch13-01-closures.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>13.1. 闭包：可以捕获环境的匿名函数</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch13-02-iterators.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>13.2. 使用迭代器处理元素序列</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch13-03-improving-our-io-project.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>13.3. 改进 I/O 项目</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch13-04-performance.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>13.4. 性能对比：循环 VS 迭代器</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>14. 进一步认识 Cargo 和 Crates.io</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch14-01-release-profiles.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>14.1. 采用发布配置自定义构建</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch14-02-publishing-to-crates-io.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>14.2. 将 crate 发布到 Crates.io</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch14-03-cargo-workspaces.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>14.3. Cargo 工作空间</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch14-04-installing-binaries.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>14.4. 使用 cargo install 从 Crates.io 安装二进制文件</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch14-05-extending-cargo.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>14.5. Cargo 自定义扩展命令</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>15. 智能指针</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch15-01-box.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>15.1. 使用Box<T>指向堆上的数据</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch15-02-deref.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>15.2. 通过 Deref trait 将智能指针当作常规引用处理</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch15-03-drop.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>15.3. 使用 Drop Trait 运行清理代码</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch15-04-rc.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>15.4. Rc<T> 引用计数智能指针</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch15-05-interior-mutability.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>15.5. RefCell<T> 和内部可变性模式</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch15-06-reference-cycles.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>15.6. 引用循环与内存泄漏</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>16. 无畏并发</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch16-01-threads.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>16.1. 使用线程同时运行代码</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch16-02-message-passing.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>16.2. 使用消息传递在线程间传送数据</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch16-03-shared-state.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>16.3. 共享状态并发</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch16-04-extensible-concurrency-sync-and-send.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>16.4. 使用 Sync 和 Send trait 的可扩展并发</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>17. Rust 的面向对象特性</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch17-01-what-is-oo.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>17.1. 面向对象语言的特征</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch17-02-trait-objects.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>17.2. 顾及不同类型值的 trait 对象</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch17-03-oo-design-patterns.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>17.3. 面向对象设计模式的实现</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>18. 模式与模式匹配</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch18-01-all-the-places-for-patterns.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>18.1. 闭包：可以捕获环境的匿名函数</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch18-02-refutability.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>18.2. Refutability（可反驳性）: 模式是否会匹配失效</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch18-03-pattern-syntax.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>18.3. 所有的模式语法</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>19. 高级特征</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch19-01-unsafe-rust.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>19.1. 不安全的 Rust</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch19-02-advanced-traits.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>19.2. 高级 trait</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch19-03-advanced-types.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>19.3. 高级类型</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch19-04-advanced-functions-and-closures.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>19.4. 高级函数与闭包</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch19-05-macros.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>19.5. 宏</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>20. 最后的项目: 构建多线程 web server</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch20-01-single-threaded.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>20.1. 构建单线程 web server</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch20-02-multithreaded.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>20.2. 将单线程 server 变为多线程 server</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/ch20-03-graceful-shutdown-and-cleanup.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>20.3. 优雅停机与清理</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-9c83b8b4><section class="VPSidebarGroup" data-v-9c83b8b4 data-v-af5fbecf><div class="title" data-v-af5fbecf><h2 class="title-text" data-v-af5fbecf>21.附录</h2><div class="action" data-v-af5fbecf><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-af5fbecf><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-af5fbecf><!--[--><!--[--><a class="VPLink link link" href="/rust-book-chinese/appendix-01-keywords.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>21.1. A - 关键字</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/appendix-02-operators.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>21.2. B - 运算符与符号</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/appendix-03-derivable-traits.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>21.3. C - 可派生的 trait</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/appendix-04-useful-development-tools.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>21.4. D - 实用开发工具</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/appendix-05-editions.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>21.5. E - 版本</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/appendix-06-translation.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>21.6. F - 本书译本</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/rust-book-chinese/appendix-07-nightly-rust.html" style="padding-left:0px;" data-v-05cdc4bb data-v-b4bd4949><!--[--><span class="link-text" data-v-05cdc4bb>21.7. 附录 G：Rust 是如何开发的与 “Nightly Rust”</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5a32397e data-v-bf1f1eb5><div class="VPDoc has-sidebar has-aside" data-v-bf1f1eb5 data-v-204ad1da><div class="container" data-v-204ad1da><div class="aside" data-v-204ad1da><div class="aside-curtain" data-v-204ad1da></div><div class="aside-container" data-v-204ad1da><div class="aside-content" data-v-204ad1da><div class="VPDocAside" data-v-204ad1da data-v-889b0252><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-889b0252 data-v-bfd809c3><div class="content" data-v-bfd809c3><div class="outline-marker" data-v-bfd809c3></div><div class="outline-title" data-v-bfd809c3>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-bfd809c3><span class="visually-hidden" id="doc-outline-aria-label" data-v-bfd809c3> Table of Contents for current page </span><ul class="root" data-v-bfd809c3 data-v-6fa2577a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-889b0252></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-204ad1da><div class="content-container" data-v-204ad1da><!--[--><!--]--><main class="main" data-v-204ad1da><div style="position:relative;" class="vp-doc _rust-book-chinese_ch10-03-lifetime-syntax" data-v-204ad1da><div><h1 id="生命周期确保引用有效" tabindex="-1">生命周期确保引用有效 <a class="header-anchor" href="#生命周期确保引用有效" aria-hidden="true">#</a></h1><blockquote><p><a href="https://github.com/rust-lang/book/blob/main/src/ch10-03-lifetime-syntax.md" target="_blank" rel="noreferrer">ch10-03-lifetime-syntax.md</a><br> commit 1b8746013079f2e2ce1c8e85f633d9769778ea7f</p></blockquote><p>当在第四章讨论 <a href="./ch04-02-references-and-borrowing.html#引用与借用">“引用和借用”</a> 部分时，我们遗漏了一个重要的细节：Rust 中的每一个引用都有其 <strong>生命周期</strong>（<em>lifetime</em>），也就是引用保持有效的作用域。大部分时候生命周期是隐含并可以推断的，正如大部分时候类型也是可以推断的一样。类似于当因为有多种可能类型的时候必须注明类型，也会出现引用的生命周期以一些不同方式相关联的情况，所以 Rust 需要我们使用泛型生命周期参数来注明他们的关系，这样就能确保运行时实际使用的引用绝对是有效的。</p><p>生命周期注解甚至不是一个大部分语言都有的概念，所以这可能感觉起来有些陌生。虽然本章不可能涉及到它全部的内容，我们会讲到一些通常你可能会遇到的生命周期语法以便你熟悉这个概念。</p><h2 id="生命周期避免了悬垂引用" tabindex="-1">生命周期避免了悬垂引用 <a class="header-anchor" href="#生命周期避免了悬垂引用" aria-hidden="true">#</a></h2><p>生命周期的主要目标是避免悬垂引用，后者会导致程序引用了非预期引用的数据。考虑一下示例 10-17 中的程序，它有一个外部作用域和一个内部作用域。</p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;">    // ANCHOR: here</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> r</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">r: </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> r</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">    // ANCHOR_END: here</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-17：尝试使用离开作用域的值的引用</span></p><blockquote><p>注意：示例 10-17、10-18 和 10-24 中声明了没有初始值的变量，所以这些变量存在于外部作用域。这乍看之下好像和 Rust 不允许存在空值相冲突。然而如果尝试在给它一个值之前使用这个变量，会出现一个编译时错误，这就说明了 Rust 确实不允许空值。</p></blockquote><p>外部作用域声明了一个没有初值的变量 <code>r</code>，而内部作用域声明了一个初值为 5 的变量<code>x</code>。在内部作用域中，我们尝试将 <code>r</code> 的值设置为一个 <code>x</code> 的引用。接着在内部作用域结束后，尝试打印出 <code>r</code> 的值。这段代码不能编译因为 <code>r</code> 引用的值在尝试使用之前就离开了作用域。如下是错误信息：</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ cargo run</span></span>
<span class="line"><span style="color:#A6ACCD;">   Compiling chapter10 v0.1.0 (file:///projects/chapter10)</span></span>
<span class="line"><span style="color:#A6ACCD;">error[E0597]: `x` does not live long enough</span></span>
<span class="line"><span style="color:#A6ACCD;">  --&gt; src/main.rs:7:17</span></span>
<span class="line"><span style="color:#A6ACCD;">   |</span></span>
<span class="line"><span style="color:#A6ACCD;">7  |             r = &amp;x;</span></span>
<span class="line"><span style="color:#A6ACCD;">   |                 ^^ borrowed value does not live long enough</span></span>
<span class="line"><span style="color:#A6ACCD;">8  |         }</span></span>
<span class="line"><span style="color:#A6ACCD;">   |         - `x` dropped here while still borrowed</span></span>
<span class="line"><span style="color:#A6ACCD;">9  | </span></span>
<span class="line"><span style="color:#A6ACCD;">10 |         println!(&quot;r: {}&quot;, r);</span></span>
<span class="line"><span style="color:#A6ACCD;">   |                           - borrow later used here</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">For more information about this error, try `rustc --explain E0597`.</span></span>
<span class="line"><span style="color:#A6ACCD;">error: could not compile `chapter10` due to previous error</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>变量 <code>x</code> 并没有 “存在的足够久”。其原因是 <code>x</code> 在到达第 7 行内部作用域结束时就离开了作用域。不过 <code>r</code> 在外部作用域仍是有效的；作用域越大我们就说它 “存在的越久”。如果 Rust 允许这段代码工作，<code>r</code> 将会引用在 <code>x</code> 离开作用域时被释放的内存，这时尝试对 <code>r</code> 做任何操作都不能正常工作。那么 Rust 是如何决定这段代码是不被允许的呢？这得益于借用检查器。</p><h3 id="借用检查器" tabindex="-1">借用检查器 <a class="header-anchor" href="#借用检查器" aria-hidden="true">#</a></h3><p>Rust 编译器有一个 <strong>借用检查器</strong>（<em>borrow checker</em>），它比较作用域来确保所有的借用都是有效的。示例 10-18 展示了与示例 10-17 相同的例子不过带有变量生命周期的注释：</p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;">    // ANCHOR: here</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> r</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">                // ---------+-- &#39;a</span></span>
<span class="line"><span style="color:#676E95;">                              //          |</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span><span style="color:#676E95;">                     //          |</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">        // -+-- &#39;b  |</span></span>
<span class="line"><span style="color:#A6ACCD;">            r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">           //  |       |</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#676E95;">                     // -+       |</span></span>
<span class="line"><span style="color:#676E95;">                              //          |</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">r: </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> r</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;"> //          |</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#676E95;">                         // ---------+</span></span>
<span class="line"><span style="color:#676E95;">    // ANCHOR_END: here</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-18：<code>r</code> 和 <code>x</code> 的生命周期注解，分别叫做 <code>&#39;a</code> 和 <code>&#39;b</code></span></p><p>这里将 <code>r</code> 的生命周期标记为 <code>&#39;a</code> 并将 <code>x</code> 的生命周期标记为 <code>&#39;b</code>。如你所见，内部的 <code>&#39;b</code> 块要比外部的生命周期 <code>&#39;a</code> 小得多。在编译时，Rust 比较这两个生命周期的大小，并发现 <code>r</code> 拥有生命周期 <code>&#39;a</code>，不过它引用了一个拥有生命周期 <code>&#39;b</code> 的对象。程序被拒绝编译，因为生命周期 <code>&#39;b</code> 比生命周期 <code>&#39;a</code> 要小：被引用的对象比它的引用者存在的时间更短。</p><p>让我们看看示例 10-19 中这个并没有产生悬垂引用且可以正确编译的例子：</p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;">    // ANCHOR: here</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">            // ----------+-- &#39;b</span></span>
<span class="line"><span style="color:#676E95;">                              //           |</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">           // --+-- &#39;a  |</span></span>
<span class="line"><span style="color:#676E95;">                              //   |       |</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">r: </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> r</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;"> //   |       |</span></span>
<span class="line"><span style="color:#676E95;">                              // --+       |</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#676E95;">                         // ----------+</span></span>
<span class="line"><span style="color:#676E95;">    // ANCHOR_END: here</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-19：一个有效的引用，因为数据比引用有着更长的生命周期</span></p><p>这里 <code>x</code> 拥有生命周期 <code>&#39;b</code>，比 <code>&#39;a</code> 要大。这就意味着 <code>r</code> 可以引用 <code>x</code>：Rust 知道 <code>r</code> 中的引用在 <code>x</code> 有效的时候也总是有效的。</p><p>现在我们已经在一个具体的例子中展示了引用的生命周期位于何处，并讨论了 Rust 如何分析生命周期来保证引用总是有效的，接下来让我们聊聊在函数的上下文中参数和返回值的泛型生命周期。</p><h2 id="函数中的泛型生命周期" tabindex="-1">函数中的泛型生命周期 <a class="header-anchor" href="#函数中的泛型生命周期" aria-hidden="true">#</a></h2><p>让我们来编写一个返回两个字符串 slice 中较长者的函数。这个函数获取两个字符串 slice 并返回一个字符串 slice。一旦我们实现了 <code>longest</code> 函数，示例 10-20 中的代码应该会打印出 <code>The longest string is abcd</code>：</p><p><span class="filename">文件名: src/main.rs</span></p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abcd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xyz</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">string1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> string2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The longest string is </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-20：<code>main</code> 函数调用 <code>longest</code> 函数来寻找两个字符串 slice 中较长的一个</span></p><p>注意这个函数获取作为引用的字符串 slice，因为我们不希望 <code>longest</code> 函数获取参数的所有权。参考之前第四章中的 <a href="./ch04-03-slices.html#字符串-slice-作为参数">“字符串 slice 作为参数”</a> 部分中更多关于为什么示例 10-20 的参数正符合我们期望的讨论。</p><p>如果尝试像示例 10-21 中那样实现 <code>longest</code> 函数，它并不能编译：</p><p><span class="filename">文件名: src/main.rs</span></p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abcd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xyz</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">string1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> string2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The longest string is </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ANCHOR: here</span></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        x</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        y</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: here</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-21：一个 <code>longest</code> 函数的实现，它返回两个字符串 slice 中较长者，现在还不能编译</span></p><p>相应地会出现如下有关生命周期的错误：</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ cargo run</span></span>
<span class="line"><span style="color:#A6ACCD;">   Compiling chapter10 v0.1.0 (file:///projects/chapter10)</span></span>
<span class="line"><span style="color:#A6ACCD;">error[E0106]: missing lifetime specifier</span></span>
<span class="line"><span style="color:#A6ACCD;"> --&gt; src/main.rs:9:33</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">9 | fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str {</span></span>
<span class="line"><span style="color:#A6ACCD;">  |               ----     ----     ^ expected named lifetime parameter</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">  = help: this function&#39;s return type contains a borrowed value, but the signature does not say whether it is borrowed from `x` or `y`</span></span>
<span class="line"><span style="color:#A6ACCD;">help: consider introducing a named lifetime parameter</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">9 | fn longest&lt;&#39;a&gt;(x: &amp;&#39;a str, y: &amp;&#39;a str) -&gt; &amp;&#39;a str {</span></span>
<span class="line"><span style="color:#A6ACCD;">  |           ++++     ++          ++          ++</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">For more information about this error, try `rustc --explain E0106`.</span></span>
<span class="line"><span style="color:#A6ACCD;">error: could not compile `chapter10` due to previous error</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>提示文本揭示了返回值需要一个泛型生命周期参数，因为 Rust 并不知道将要返回的引用是指向 <code>x</code> 或 <code>y</code>。事实上我们也不知道，因为函数体中 <code>if</code> 块返回一个 <code>x</code> 的引用而 <code>else</code> 块返回一个 <code>y</code> 的引用！</p><p>当我们定义这个函数的时候，并不知道传递给函数的具体值，所以也不知道到底是 <code>if</code> 还是 <code>else</code> 会被执行。我们也不知道传入的引用的具体生命周期，所以也就不能像示例 10-18 和 10-19 那样通过观察作用域来确定返回的引用是否总是有效。借用检查器自身同样也无法确定，因为它不知道 <code>x</code> 和 <code>y</code> 的生命周期是如何与返回值的生命周期相关联的。为了修复这个错误，我们将增加泛型生命周期参数来定义引用间的关系以便借用检查器可以进行分析。</p><h2 id="生命周期注解语法" tabindex="-1">生命周期注解语法 <a class="header-anchor" href="#生命周期注解语法" aria-hidden="true">#</a></h2><p>生命周期注解并不改变任何引用的生命周期的长短。与当函数签名中指定了泛型类型参数后就可以接受任何类型一样，当指定了泛型生命周期后函数也能接受任何生命周期的引用。生命周期注解描述了多个引用生命周期相互的关系，而不影响其生命周期。</p><p>生命周期注解有着一个不太常见的语法：生命周期参数名称必须以撇号（<code>&#39;</code>）开头，其名称通常全是小写，类似于泛型其名称非常短。<code>&#39;a</code> 是大多数人默认使用的名称。生命周期参数注解位于引用的 <code>&amp;</code> 之后，并有一个空格来将引用类型与生命周期注解分隔开。</p><p>这里有一些例子：我们有一个没有生命周期参数的 <code>i32</code> 的引用，一个有叫做 <code>&#39;a</code> 的生命周期参数的 <code>i32</code> 的引用，和一个生命周期也是 <code>&#39;a</code> 的 <code>i32</code> 的可变引用：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">&amp;i32        // 引用</span></span>
<span class="line"><span style="color:#A6ACCD;">&amp;&#39;a i32     // 带有显式生命周期的引用</span></span>
<span class="line"><span style="color:#A6ACCD;">&amp;&#39;a mut i32 // 带有显式生命周期的可变引用</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>单个的生命周期注解本身没有多少意义，因为生命周期注解告诉 Rust 多个引用的泛型生命周期参数如何相互联系的。例如如果函数有一个生命周期 <code>&#39;a</code> 的 <code>i32</code> 的引用的参数 <code>first</code>。还有另一个同样是生命周期 <code>&#39;a</code> 的 <code>i32</code> 的引用的参数 <code>second</code>。这两个生命周期注解意味着引用 <code>first</code> 和 <code>second</code> 必须与这泛型生命周期存在得一样久。</p><h2 id="函数签名中的生命周期注解" tabindex="-1">函数签名中的生命周期注解 <a class="header-anchor" href="#函数签名中的生命周期注解" aria-hidden="true">#</a></h2><p>现在来看看 <code>longest</code> 函数的上下文中的生命周期。就像泛型类型参数，泛型生命周期参数需要声明在函数名和参数列表间的尖括号中。 在这个签名中我们想要表达的限制是所有（两个）参数和返回的引用的生命周期是相关的，也就是这两个参数和返回的引用存活的一样久。就像示例 10-22 中在每个引用中都加上了 <code>&#39;a</code> 那样：</p><p><span class="filename">文件名: src/main.rs</span></p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abcd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xyz</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">string1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> string2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The longest string is </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ANCHOR: here</span></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        x</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        y</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: here</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-22：<code>longest</code> 函数定义指定了签名中所有的引用必须有相同的生命周期 <code>&#39;a</code></span></p><p>这段代码能够编译并会产生我们希望得到的示例 10-20 中的 <code>main</code> 函数的结果。</p><p>现在函数签名表明对于某些生命周期 <code>&#39;a</code>，函数会获取两个参数，他们都是与生命周期 <code>&#39;a</code> 存在的一样长的字符串 slice。函数会返回一个同样也与生命周期 <code>&#39;a</code> 存在的一样长的字符串 slice。它的实际含义是 <code>longest</code> 函数返回的引用的生命周期与传入该函数的引用的生命周期的较小者一致。这些关系就是我们希望 Rust 分析代码时所使用的。</p><p>记住通过在函数签名中指定生命周期参数时，我们并没有改变任何传入值或返回值的生命周期，而是指出任何不满足这个约束条件的值都将被借用检查器拒绝。注意 <code>longest</code> 函数并不需要知道 <code>x</code> 和 <code>y</code> 具体会存在多久，而只需要知道有某个可以被 <code>&#39;a</code> 替代的作用域将会满足这个签名。</p><p>当在函数中使用生命周期注解时，这些注解出现在函数签名中，而不存在于函数体中的任何代码中。生命周期注解成为了函数约定的一部分，非常像签名中的类型。让函数签名包含生命周期约定意味着 Rust 编译器的工作变得更简单了。如果函数注解有误或者调用方法不对，编译器错误可以更准确地指出代码和限制的部分。如果不这么做的话，Rust 编译会对我们期望的生命周期关系做更多的推断，这样编译器可能只能指出离出问题地方很多步之外的代码。</p><p>当具体的引用被传递给 <code>longest</code> 时，被 <code>&#39;a</code> 所替代的具体生命周期是 <code>x</code> 的作用域与 <code>y</code> 的作用域相重叠的那一部分。换一种说法就是泛型生命周期 <code>&#39;a</code> 的具体生命周期等同于 <code>x</code> 和 <code>y</code> 的生命周期中较小的那一个。因为我们用相同的生命周期参数 <code>&#39;a</code> 标注了返回的引用值，所以返回的引用值就能保证在 <code>x</code> 和 <code>y</code> 中较短的那个生命周期结束之前保持有效。</p><p>让我们看看如何通过传递拥有不同具体生命周期的引用来限制 <code>longest</code> 函数的使用。示例 10-23 是一个很直观的例子。</p><p><span class="filename">文件名: src/main.rs</span></p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// ANCHOR: here</span></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">long string is long</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xyz</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">string1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> string2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The longest string is </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: here</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        x</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        y</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-23：通过拥有不同的具体生命周期的 <code>String</code> 值调用 <code>longest</code> 函数</span></p><p>在这个例子中，<code>string1</code> 直到外部作用域结束都是有效的，<code>string2</code> 则在内部作用域中是有效的，而 <code>result</code> 则引用了一些直到内部作用域结束都是有效的值。借用检查器认可这些代码；它能够编译和运行，并打印出 <code>The longest string is long string is long</code>。</p><p>接下来，让我们尝试另外一个例子，该例子揭示了 <code>result</code> 的引用的生命周期必须是两个参数中较短的那个。以下代码将 <code>result</code> 变量的声明移动出内部作用域，但是将 <code>result</code> 和 <code>string2</code> 变量的赋值语句一同留在内部作用域中。接着，使用了变量 <code>result</code> 的 <code>println!</code> 也被移动到内部作用域之外。注意示例 10-24 中的代码不能通过编译：</p><p><span class="filename">文件名: src/main.rs</span></p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// ANCHOR: here</span></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">long string is long</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xyz</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">string1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> string2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The longest string is </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: here</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        x</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        y</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-24：尝试在 <code>string2</code> 离开作用域之后使用 <code>result</code></span></p><p>如果尝试编译会出现如下错误：</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ cargo run</span></span>
<span class="line"><span style="color:#A6ACCD;">   Compiling chapter10 v0.1.0 (file:///projects/chapter10)</span></span>
<span class="line"><span style="color:#A6ACCD;">error[E0597]: `string2` does not live long enough</span></span>
<span class="line"><span style="color:#A6ACCD;"> --&gt; src/main.rs:6:44</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">6 |         result = longest(string1.as_str(), string2.as_str());</span></span>
<span class="line"><span style="color:#A6ACCD;">  |                                            ^^^^^^^^^^^^^^^^ borrowed value does not live long enough</span></span>
<span class="line"><span style="color:#A6ACCD;">7 |     }</span></span>
<span class="line"><span style="color:#A6ACCD;">  |     - `string2` dropped here while still borrowed</span></span>
<span class="line"><span style="color:#A6ACCD;">8 |     println!(&quot;The longest string is {}&quot;, result);</span></span>
<span class="line"><span style="color:#A6ACCD;">  |                                          ------ borrow later used here</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">For more information about this error, try `rustc --explain E0597`.</span></span>
<span class="line"><span style="color:#A6ACCD;">error: could not compile `chapter10` due to previous error</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>错误表明为了保证 <code>println!</code> 中的 <code>result</code> 是有效的，<code>string2</code> 需要直到外部作用域结束都是有效的。Rust 知道这些是因为（<code>longest</code>）函数的参数和返回值都使用了相同的生命周期参数 <code>&#39;a</code>。</p><p>如果从人的角度读上述代码，我们可能会觉得这个代码是正确的。 <code>string1</code> 更长，因此 <code>result</code> 会包含指向 <code>string1</code> 的引用。因为 <code>string1</code> 尚未离开作用域，对于 <code>println!</code> 来说 <code>string1</code> 的引用仍然是有效的。然而，我们通过生命周期参数告诉 Rust 的是： <code>longest</code> 函数返回的引用的生命周期应该与传入参数的生命周期中较短那个保持一致。因此，借用检查器不允许示例 10-24 中的代码，因为它可能会存在无效的引用。</p><p>请尝试更多采用不同的值和不同生命周期的引用作为 <code>longest</code> 函数的参数和返回值的实验。并在开始编译前猜想你的实验能否通过借用检查器，接着编译一下看看你的理解是否正确！</p><h2 id="深入理解生命周期" tabindex="-1">深入理解生命周期 <a class="header-anchor" href="#深入理解生命周期" aria-hidden="true">#</a></h2><p>指定生命周期参数的正确方式依赖函数实现的具体功能。例如，如果将 <code>longest</code> 函数的实现修改为总是返回第一个参数而不是最长的字符串 slice，就不需要为参数 <code>y</code> 指定一个生命周期。如下代码将能够编译：</p><p><span class="filename">文件名: src/main.rs</span></p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abcd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">efghijklmnopqrstuvwxyz</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">string1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> string2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The longest string is </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ANCHOR: here</span></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    x</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: here</span></span>
<span class="line"></span></code></pre></div><p>在这个例子中，我们为参数 <code>x</code> 和返回值指定了生命周期参数 <code>&#39;a</code>，不过没有为参数 <code>y</code> 指定，因为 <code>y</code> 的生命周期与参数 <code>x</code> 和返回值的生命周期没有任何关系。</p><p>当从函数返回一个引用，返回值的生命周期参数需要与一个参数的生命周期参数相匹配。如果返回的引用 <strong>没有</strong> 指向任何一个参数，那么唯一的可能就是它指向一个函数内部创建的值，它将会是一个悬垂引用，因为它将会在函数结束时离开作用域。尝试考虑这个并不能编译的 <code>longest</code> 函数实现：</p><p><span class="filename">文件名: src/main.rs</span></p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abcd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xyz</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">string1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> string2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The longest string is </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ANCHOR: here</span></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">really long string</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: here</span></span>
<span class="line"></span></code></pre></div><p>即便我们为返回值指定了生命周期参数 <code>&#39;a</code>，这个实现却编译失败了，因为返回值的生命周期与参数完全没有关联。这里是会出现的错误信息：</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">$ cargo run</span></span>
<span class="line"><span style="color:#A6ACCD;">   Compiling chapter10 v0.1.0 (file:///projects/chapter10)</span></span>
<span class="line"><span style="color:#A6ACCD;">error[E0515]: cannot return reference to local variable `result`</span></span>
<span class="line"><span style="color:#A6ACCD;">  --&gt; src/main.rs:11:5</span></span>
<span class="line"><span style="color:#A6ACCD;">   |</span></span>
<span class="line"><span style="color:#A6ACCD;">11 |     result.as_str()</span></span>
<span class="line"><span style="color:#A6ACCD;">   |     ^^^^^^^^^^^^^^^ returns a reference to data owned by the current function</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">For more information about this error, try `rustc --explain E0515`.</span></span>
<span class="line"><span style="color:#A6ACCD;">error: could not compile `chapter10` due to previous error</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>出现的问题是 <code>result</code> 在 <code>longest</code> 函数的结尾将离开作用域并被清理，而我们尝试从函数返回一个 <code>result</code> 的引用。无法指定生命周期参数来改变悬垂引用，而且 Rust 也不允许我们创建一个悬垂引用。在这种情况，最好的解决方案是返回一个有所有权的数据类型而不是一个引用，这样函数调用者就需要负责清理这个值了。</p><p>综上，生命周期语法是用于将函数的多个参数与其返回值的生命周期进行关联的。一旦他们形成了某种关联，Rust 就有了足够的信息来允许内存安全的操作并阻止会产生悬垂指针亦或是违反内存安全的行为。</p><h2 id="结构体定义中的生命周期注解" tabindex="-1">结构体定义中的生命周期注解 <a class="header-anchor" href="#结构体定义中的生命周期注解" aria-hidden="true">#</a></h2><p>目前为止，我们只定义过有所有权类型的结构体。接下来，我们将定义包含引用的结构体，不过这需要为结构体定义中的每一个引用添加生命周期注解。示例 10-25 中有一个存放了一个字符串 slice 的结构体 <code>ImportantExcerpt</code>：</p><p><span class="filename">文件名: src/main.rs</span></p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    part</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> novel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Call me Ishmael. Some years ago...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> first_sentence </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> novel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">next</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">expect</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Could not find a &#39;.&#39;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        part</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> first_sentence</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-25：一个存放引用的结构体，所以其定义需要生命周期注解</span></p><p>这个结构体有一个字段，<code>part</code>，它存放了一个字符串 slice，这是一个引用。类似于泛型参数类型，必须在结构体名称后面的尖括号中声明泛型生命周期参数，以便在结构体定义中使用生命周期参数。这个注解意味着 <code>ImportantExcerpt</code> 的实例不能比其 <code>part</code> 字段中的引用存在的更久。</p><p>这里的 <code>main</code> 函数创建了一个 <code>ImportantExcerpt</code> 的实例，它存放了变量 <code>novel</code> 所拥有的 <code>String</code> 的第一个句子的引用。<code>novel</code> 的数据在 <code>ImportantExcerpt</code> 实例创建之前就存在。另外，直到 <code>ImportantExcerpt</code> 离开作用域之后 <code>novel</code> 都不会离开作用域，所以 <code>ImportantExcerpt</code> 实例中的引用是有效的。</p><h2 id="生命周期省略-lifetime-elision" tabindex="-1">生命周期省略（Lifetime Elision） <a class="header-anchor" href="#生命周期省略-lifetime-elision" aria-hidden="true">#</a></h2><p>现在我们已经知道了每一个引用都有一个生命周期，而且我们需要为那些使用了引用的函数或结构体指定生命周期。然而，第四章的示例 4-9 中有一个函数，如示例 10-26 所示，它没有生命周期注解却能编译成功：</p><p><span class="filename">文件名: src/lib.rs</span></p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// ANCHOR: here</span></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">first_word</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> bytes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> s</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_bytes</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> bytes</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">iter</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">enumerate</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> item </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">[..]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: here</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> my_string </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">    // first_word works on slices of `String`s</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> word </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">first_word</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">my_string</span><span style="color:#89DDFF;">[..]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> my_string_literal </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">    // first_word works on slices of string literals</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> word </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">first_word</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">my_string_literal</span><span style="color:#89DDFF;">[..]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">    // Because string literals *are* string slices already,</span></span>
<span class="line"><span style="color:#676E95;">    // this works too, without the slice syntax!</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> word </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">first_word</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">my_string_literal</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><span class="caption">示例 10-26：示例 4-9 定义了一个没有使用生命周期注解的函数，即便其参数和返回值都是引用</span></p><p>这个函数没有生命周期注解却能编译是由于一些历史原因：在早期版本（pre-1.0）的 Rust 中，这的确是不能编译的。每一个引用都必须有明确的生命周期。那时的函数签名将会写成这样：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">fn first_word&lt;&#39;a&gt;(s: &amp;&#39;a str) -&gt; &amp;&#39;a str {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>在编写了很多 Rust 代码后，Rust 团队发现在特定情况下 Rust 程序员们总是重复地编写一模一样的生命周期注解。这些场景是可预测的并且遵循几个明确的模式。接着 Rust 团队就把这些模式编码进了 Rust 编译器中，如此借用检查器在这些情况下就能推断出生命周期而不再强制程序员显式的增加注解。</p><p>这里我们提到一些 Rust 的历史是因为更多的明确的模式被合并和添加到编译器中是完全可能的。未来只会需要更少的生命周期注解。</p><p>被编码进 Rust 引用分析的模式被称为 <strong>生命周期省略规则</strong>（<em>lifetime elision rules</em>）。这并不是需要程序员遵守的规则；这些规则是一系列特定的场景，此时编译器会考虑，如果代码符合这些场景，就无需明确指定生命周期。</p><p>省略规则并不提供完整的推断：如果 Rust 在明确遵守这些规则的前提下变量的生命周期仍然是模棱两可的话，它不会猜测剩余引用的生命周期应该是什么。在这种情况，编译器会给出一个错误，这可以通过增加对应引用之间相联系的生命周期注解来解决。</p><p>函数或方法的参数的生命周期被称为 <strong>输入生命周期</strong>（<em>input lifetimes</em>），而返回值的生命周期被称为 <strong>输出生命周期</strong>（<em>output lifetimes</em>）。</p><p>编译器采用三条规则来判断引用何时不需要明确的注解。第一条规则适用于输入生命周期，后两条规则适用于输出生命周期。如果编译器检查完这三条规则后仍然存在没有计算出生命周期的引用，编译器将会停止并生成错误。这些规则适用于 <code>fn</code> 定义，以及 <code>impl</code> 块。</p><p>第一条规则是每一个是引用的参数都有它自己的生命周期参数。换句话说就是，有一个引用参数的函数有一个生命周期参数：<code>fn foo&lt;&#39;a&gt;(x: &amp;&#39;a i32)</code>，有两个引用参数的函数有两个不同的生命周期参数，<code>fn foo&lt;&#39;a, &#39;b&gt;(x: &amp;&#39;a i32, y: &amp;&#39;b i32)</code>，依此类推。</p><p>第二条规则是如果只有一个输入生命周期参数，那么它被赋予所有输出生命周期参数：<code>fn foo&lt;&#39;a&gt;(x: &amp;&#39;a i32) -&gt; &amp;&#39;a i32</code>。</p><p>第三条规则是如果方法有多个输入生命周期参数并且其中一个参数是 <code>&amp;self</code> 或 <code>&amp;mut self</code>，说明是个对象的方法(method)(译者注： 这里涉及rust的面向对象参见17章)，那么所有输出生命周期参数被赋予 <code>self</code> 的生命周期。第三条规则使得方法更容易读写，因为只需更少的符号。</p><p>假设我们自己就是编译器。并应用这些规则来计算示例 10-26 中 <code>first_word</code> 函数签名中的引用的生命周期。开始时签名中的引用并没有关联任何生命周期：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">fn first_word(s: &amp;str) -&gt; &amp;str {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>接着编译器应用第一条规则，也就是每个引用参数都有其自己的生命周期。我们像往常一样称之为 <code>&#39;a</code>，所以现在签名看起来像这样：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">fn first_word&lt;&#39;a&gt;(s: &amp;&#39;a str) -&gt; &amp;str {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>对于第二条规则，因为这里正好只有一个输入生命周期参数所以是适用的。第二条规则表明输入参数的生命周期将被赋予输出生命周期参数，所以现在签名看起来像这样：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">fn first_word&lt;&#39;a&gt;(s: &amp;&#39;a str) -&gt; &amp;&#39;a str {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>现在这个函数签名中的所有引用都有了生命周期，如此编译器可以继续它的分析而无须程序员标记这个函数签名中的生命周期。</p><p>让我们再看看另一个例子，这次我们从示例 10-21 中没有生命周期参数的 <code>longest</code> 函数开始：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>再次假设我们自己就是编译器并应用第一条规则：每个引用参数都有其自己的生命周期。这次有两个参数，所以就有两个（不同的）生命周期：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">fn longest&lt;&#39;a, &#39;b&gt;(x: &amp;&#39;a str, y: &amp;&#39;b str) -&gt; &amp;str {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>再来应用第二条规则，因为函数存在多个输入生命周期，它并不适用于这种情况。再来看第三条规则，它同样也不适用，这是因为没有 <code>self</code> 参数。应用了三个规则之后编译器还没有计算出返回值类型的生命周期。这就是为什么在编译示例 10-21 的代码时会出现错误的原因：编译器使用所有已知的生命周期省略规则，仍不能计算出签名中所有引用的生命周期。</p><p>因为第三条规则真正能够适用的就只有方法签名，现在就让我们看看那种情况中的生命周期，并看看为什么这条规则意味着我们经常不需要在方法签名中标注生命周期。</p><h2 id="方法定义中的生命周期注解" tabindex="-1">方法定义中的生命周期注解 <a class="header-anchor" href="#方法定义中的生命周期注解" aria-hidden="true">#</a></h2><p>当为带有生命周期的结构体实现方法时，其语法依然类似示例 10-11 中展示的泛型类型参数的语法。声明和使用生命周期参数的位置依赖于生命周期参数是否同结构体字段或方法参数和返回值相关。</p><p>（实现方法时）结构体字段的生命周期必须总是在 <code>impl</code> 关键字之后声明并在结构体名称之后被使用，因为这些生命周期是结构体类型的一部分。</p><p><code>impl</code> 块里的方法签名中，引用可能与结构体字段中的引用相关联，也可能是独立的。另外，生命周期省略规则也经常让我们无需在方法签名中使用生命周期注解。让我们看看一些使用示例 10-25 中定义的结构体 <code>ImportantExcerpt</code> 的例子。</p><p>首先，这里有一个方法 <code>level</code>。其唯一的参数是 <code>self</code> 的引用，而且返回值只是一个 <code>i32</code>，并不引用任何值：</p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    part</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ANCHOR: 1st</span></span>
<span class="line"><span style="color:#F78C6C;">impl</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">level</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i32</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: 1st</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ANCHOR: 3rd</span></span>
<span class="line"><span style="color:#F78C6C;">impl</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">announce_and_return_part</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> announcement</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Attention please: </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> announcement</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">part</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: 3rd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> novel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Call me Ishmael. Some years ago...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> first_sentence </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> novel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">next</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">expect</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Could not find a &#39;.&#39;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        part</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> first_sentence</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>impl</code> 之后和类型名称之后的生命周期参数是必要的，不过因为第一条生命周期规则我们并不必须标注 <code>self</code> 引用的生命周期。</p><p>这里是一个适用于第三条生命周期省略规则的例子：</p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    part</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ANCHOR: 1st</span></span>
<span class="line"><span style="color:#F78C6C;">impl</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">level</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i32</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: 1st</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ANCHOR: 3rd</span></span>
<span class="line"><span style="color:#F78C6C;">impl</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">announce_and_return_part</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> announcement</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Attention please: </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> announcement</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">part</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: 3rd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> novel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Call me Ishmael. Some years ago...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> first_sentence </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> novel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">next</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">expect</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Could not find a &#39;.&#39;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportantExcerpt</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        part</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> first_sentence</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>这里有两个输入生命周期，所以 Rust 应用第一条生命周期省略规则并给予 <code>&amp;self</code> 和 <code>announcement</code> 他们各自的生命周期。接着，因为其中一个参数是 <code>&amp;self</code>，返回值类型被赋予了 <code>&amp;self</code> 的生命周期，这样所有的生命周期都被计算出来了。</p><h2 id="静态生命周期" tabindex="-1">静态生命周期 <a class="header-anchor" href="#静态生命周期" aria-hidden="true">#</a></h2><p>这里有一种特殊的生命周期值得讨论：<code>&#39;static</code>，其生命周期<strong>能够</strong>存活于整个程序期间。所有的字符串字面值都拥有 <code>&#39;static</code> 生命周期，我们也可以选择像下面这样标注出来：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">let s: &amp;&#39;static str = &quot;I have a static lifetime.&quot;;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>这个字符串的文本被直接储存在程序的二进制文件中而这个文件总是可用的。因此所有的字符串字面值都是 <code>&#39;static</code> 的。</p><p>你可能在错误信息的帮助文本中见过使用 <code>&#39;static</code> 生命周期的建议，不过将引用指定为 <code>&#39;static</code> 之前，思考一下这个引用是否真的在整个程序的生命周期里都有效。你也许要考虑是否希望它存在得这么久，即使这是可能的。大部分情况，代码中的问题是尝试创建一个悬垂引用或者可用的生命周期不匹配，请解决这些问题而不是指定一个 <code>&#39;static</code> 的生命周期。</p><h2 id="结合泛型类型参数、trait-bounds-和生命周期" tabindex="-1">结合泛型类型参数、trait bounds 和生命周期 <a class="header-anchor" href="#结合泛型类型参数、trait-bounds-和生命周期" aria-hidden="true">#</a></h2><p>让我们简要的看一下在同一函数中指定泛型类型参数、trait bounds 和生命周期的语法！</p><div class="language-rs"><button title="Copy Code" class="copy"></button><span class="lang">rs</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abcd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> string2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xyz</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest_with_an_announcement</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        string1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#A6ACCD;">        string2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Today is someone&#39;s birthday!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">The longest string is </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// ANCHOR: here</span></span>
<span class="line"><span style="color:#F78C6C;">use</span><span style="color:#FFCB6B;"> std</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">fmt</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Display</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longest_with_an_announcement</span><span style="color:#89DDFF;">&lt;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;(</span></span>
<span class="line"><span style="color:#A6ACCD;">    x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    ann</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&#39;</span><span style="color:#FFCB6B;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span></span>
<span class="line"><span style="color:#F78C6C;">where</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Display</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Announcement! </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ann</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        x</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        y</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// ANCHOR_END: here</span></span>
<span class="line"></span></code></pre></div><p>这个是示例 10-22 中那个返回两个字符串 slice 中较长者的 <code>longest</code> 函数，不过带有一个额外的参数 <code>ann</code>。<code>ann</code> 的类型是泛型 <code>T</code>，它可以被放入任何实现了 <code>where</code> 从句中指定的 <code>Display</code> trait 的类型。这个额外的参数会使用 <code>{}</code> 打印，这也就是为什么 <code>Display</code> trait bound 是必须的。因为生命周期也是泛型，所以生命周期参数 <code>&#39;a</code> 和泛型类型参数 <code>T</code> 都位于函数名后的同一尖括号列表中。</p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h2><p>这一章介绍了很多的内容！现在你知道了泛型类型参数、trait 和 trait bounds 以及泛型生命周期类型，你已经准备好编写既不重复又能适用于多种场景的代码了。泛型类型参数意味着代码可以适用于不同的类型。trait 和 trait bounds 保证了即使类型是泛型的，这些类型也会拥有所需要的行为。由生命周期注解所指定的引用生命周期之间的关系保证了这些灵活多变的代码不会出现悬垂引用。而所有的这一切发生在编译时所以不会影响运行时效率！</p><p>你可能不会相信，这个话题还有更多需要学习的内容：第十七章会讨论 trait 对象，这是另一种使用 trait 的方式。还有更多更复杂的涉及生命周期注解的场景，只有在非常高级的情况下才会需要它们；对于这些内容，请阅读 <a href="https://doc.rust-lang.org/reference/index.html" target="_blank" rel="noreferrer">Rust Reference</a>。不过接下来，让我们聊聊如何在 Rust 中编写测试，来确保代码的所有功能能像我们希望的那样工作！</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-204ad1da data-v-de6da58b><div class="edit-info" data-v-de6da58b><!----><div class="last-updated" data-v-de6da58b><p class="VPLastUpdated" data-v-de6da58b data-v-7c4616c1>Last updated: <time datetime="2022-11-18T02:03:29.000Z" data-v-7c4616c1></time></p></div></div><div class="prev-next" data-v-de6da58b><div class="pager" data-v-de6da58b><a class="pager-link prev" href="/rust-book-chinese/ch10-02-traits.html" data-v-de6da58b><span class="desc" data-v-de6da58b>Previous page</span><span class="title" data-v-de6da58b>10.2. Trait：定义共同行为</span></a></div><div class="has-prev pager" data-v-de6da58b><a class="pager-link next" href="/rust-book-chinese/ch11-01-writing-tests.html" data-v-de6da58b><span class="desc" data-v-de6da58b>Next page</span><span class="title" data-v-de6da58b>11.1. 如何编写测试</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"preface.md\":\"9520ffbf\",\"readme.md\":\"06d8582a\",\"summary.md\":\"5a117708\",\"appendix-00.md\":\"5a031a8d\",\"appendix-01-keywords.md\":\"4f8695cd\",\"appendix-02-operators.md\":\"d2ffe275\",\"appendix-03-derivable-traits.md\":\"5731e087\",\"appendix-04-useful-development-tools.md\":\"d65ccd6b\",\"appendix-05-editions.md\":\"44194ab3\",\"appendix-06-translation.md\":\"6c935bb2\",\"appendix-07-nightly-rust.md\":\"2d365e38\",\"ch00-00-introduction.md\":\"56ec5913\",\"ch01-00-getting-started.md\":\"1bb4030b\",\"ch01-01-installation.md\":\"8f93eccd\",\"ch01-02-hello-world.md\":\"bad38f5b\",\"ch01-03-hello-cargo.md\":\"6b94d2e9\",\"ch02-00-guessing-game-tutorial.md\":\"b9b5cc29\",\"ch03-00-common-programming-concepts.md\":\"b52ffe24\",\"ch03-01-variables-and-mutability.md\":\"3a8d30f6\",\"ch03-02-data-types.md\":\"0866ae1b\",\"ch03-03-how-functions-work.md\":\"d325cab0\",\"ch03-04-comments.md\":\"96057621\",\"ch03-05-control-flow.md\":\"a616f881\",\"ch04-00-understanding-ownership.md\":\"cd48ec36\",\"ch04-01-what-is-ownership.md\":\"43331ff5\",\"ch04-02-references-and-borrowing.md\":\"6a337bd1\",\"ch04-03-slices.md\":\"f3e60c15\",\"ch05-00-structs.md\":\"1cfe06d4\",\"ch05-01-defining-structs.md\":\"ce1c5e77\",\"ch05-02-example-structs.md\":\"232c8506\",\"ch05-03-method-syntax.md\":\"f01e008b\",\"ch06-00-enums.md\":\"8c31c114\",\"ch06-01-defining-an-enum.md\":\"78fa3ca6\",\"ch06-02-match.md\":\"e9cf9fad\",\"ch06-03-if-let.md\":\"79f67ef7\",\"ch07-00-managing-growing-projects-with-packages-crates-and-modules.md\":\"7cc5ccf7\",\"ch07-01-packages-and-crates.md\":\"02ef8bc7\",\"ch07-02-defining-modules-to-control-scope-and-privacy.md\":\"d981da0f\",\"ch07-03-paths-for-referring-to-an-item-in-the-module-tree.md\":\"858170bd\",\"ch07-04-bringing-paths-into-scope-with-the-use-keyword.md\":\"3814d465\",\"ch07-05-separating-modules-into-different-files.md\":\"f31a9d85\",\"ch08-00-common-collections.md\":\"3554a69f\",\"ch08-01-vectors.md\":\"afd31408\",\"ch08-02-strings.md\":\"edaadc5d\",\"ch08-03-hash-maps.md\":\"fd056d7d\",\"ch09-00-error-handling.md\":\"d3179968\",\"ch09-01-unrecoverable-errors-with-panic.md\":\"06586431\",\"ch09-02-recoverable-errors-with-result.md\":\"c2033828\",\"ch09-03-to-panic-or-not-to-panic.md\":\"a3654175\",\"ch10-00-generics.md\":\"bcf433d3\",\"ch10-01-syntax.md\":\"019ef3ff\",\"ch10-02-traits.md\":\"d4182be2\",\"ch10-03-lifetime-syntax.md\":\"d6b72f04\",\"ch11-00-testing.md\":\"768f717e\",\"ch11-01-writing-tests.md\":\"35af717d\",\"ch11-02-running-tests.md\":\"a3910f15\",\"ch11-03-test-organization.md\":\"9842614e\",\"ch12-00-an-io-project.md\":\"fb3a90fc\",\"ch12-01-accepting-command-line-arguments.md\":\"2af284d6\",\"ch12-02-reading-a-file.md\":\"075edc00\",\"ch12-03-improving-error-handling-and-modularity.md\":\"4d5bd04e\",\"ch12-04-testing-the-librarys-functionality.md\":\"956f93ef\",\"ch12-05-working-with-environment-variables.md\":\"d10f9d0d\",\"ch12-06-writing-to-stderr-instead-of-stdout.md\":\"2313932f\",\"ch13-00-functional-features.md\":\"43eb9178\",\"ch13-01-closures.md\":\"0d0483d6\",\"ch13-02-iterators.md\":\"7d9bf091\",\"ch13-03-improving-our-io-project.md\":\"1893bded\",\"ch13-04-performance.md\":\"a47c24e6\",\"ch14-00-more-about-cargo.md\":\"1cc36b44\",\"ch14-01-release-profiles.md\":\"4b4226fb\",\"ch14-02-publishing-to-crates-io.md\":\"a84d6bc5\",\"ch14-03-cargo-workspaces.md\":\"160ca4f0\",\"ch14-04-installing-binaries.md\":\"868d3da7\",\"ch14-05-extending-cargo.md\":\"6d30d513\",\"ch15-00-smart-pointers.md\":\"00e37b2b\",\"ch15-01-box.md\":\"803d7139\",\"ch15-02-deref.md\":\"221fdbd7\",\"ch15-03-drop.md\":\"60940054\",\"ch15-04-rc.md\":\"2837f5cc\",\"ch15-05-interior-mutability.md\":\"e691413b\",\"ch15-06-reference-cycles.md\":\"021cbe29\",\"ch16-00-concurrency.md\":\"7f964092\",\"ch16-01-threads.md\":\"d522f3f6\",\"ch16-02-message-passing.md\":\"03d9a6d9\",\"ch16-03-shared-state.md\":\"e1a1cede\",\"ch16-04-extensible-concurrency-sync-and-send.md\":\"23ea53d2\",\"ch17-00-oop.md\":\"456ee697\",\"ch17-01-what-is-oo.md\":\"ca02b63b\",\"ch17-02-trait-objects.md\":\"a1b6ac93\",\"ch17-03-oo-design-patterns.md\":\"005cd20e\",\"ch18-00-patterns.md\":\"e724c45b\",\"ch18-01-all-the-places-for-patterns.md\":\"c302d9b0\",\"ch18-02-refutability.md\":\"c30a3b8a\",\"ch18-03-pattern-syntax.md\":\"fff2fec6\",\"ch19-00-advanced-features.md\":\"bc15db3b\",\"ch19-01-unsafe-rust.md\":\"181c3fa8\",\"ch19-02-advanced-traits.md\":\"b9f98a46\",\"ch19-03-advanced-types.md\":\"70e3d746\",\"ch19-04-advanced-functions-and-closures.md\":\"701e9e92\",\"ch19-05-macros.md\":\"68e69da6\",\"ch20-00-final-project-a-web-server.md\":\"d78cbde4\",\"ch20-01-single-threaded.md\":\"2147534a\",\"ch20-02-multithreaded.md\":\"f168b987\",\"ch20-03-graceful-shutdown-and-cleanup.md\":\"6ee28c0b\",\"foreword.md\":\"1c903107\",\"index.md\":\"63335616\",\"title-page.md\":\"3ae2f7bc\"}")</script>
    <script type="module" async src="/rust-book-chinese/assets/app.c05c6abe.js"></script>
    
  </body>
</html>